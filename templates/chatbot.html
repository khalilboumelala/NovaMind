<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaMind Chat Bot</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style2.css') }}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
</head>
<body>
    <!-- Chatbot Interface -->
    <div class="chatbot">
        <div class="chatbot-sidebar">
            <h3>Conversation History</h3>
            <ul id="conversation-history">
                <!-- Conversation history dynamically populated -->
                {% for thread in threads %}
                    <li>
                        <a href="{{ url_for('chatbot', thread_id=thread.id) }}">{{ thread.title }}</a>
                    </li>
                {% endfor %}
            </ul>
        </div>

        <div class="chatbot-main">
            <header>
                <h2>NovaMind</h2>
                <span class="close-btn material-symbols-outlined">close</span>
            </header>

            <ul class="chat-window" id="chat-window">
                <!-- Existing chat history -->
                {% for message in messages %}
                    <li class="chat {% if message.role == 'user' %}outgoing-chat{% else %}incoming-chat{% endif %}">
                        <span class="material-symbols-outlined">
                            {% if message.role == 'user' %}person{% else %}support_agent{% endif %}
                        </span>
                        <p>{{ message.message }}</p>
                    </li>
                {% endfor %}
            </ul>

            <div class="AI-Input">
                <input type="file" id="camera" accept="image/*" capture="environment" />
                <input type="file" id="photos" accept="image/*" />
                <input type="file" id="files" />
                <input id="voice" type="checkbox" />
                <label for="voice">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="var(--neutral-color)" viewBox="0 0 16 16">
                        <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"></path>
                    </svg>
                </label>
                <input id="mic" type="checkbox" />
                <label for="mic">
                    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="var(--neutral-color)" viewBox="0 0 16 16">
                        <path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5"></path>
                        <path d="M10 8a2 2 0 1 1-4 0V3a2 2 0 1 1 4 0zM8 0a3 3 0 0 0-3 3v5a3 3 0 0 0 6 0V3a3 3 0 0 0-3-3"></path>
                    </svg>
                </label>
                <div class="chat-marquee">
                    <ul>
                        <li>Create an image</li>
                        <li>Give me ideas</li>
                        <li>Write a text</li>
                        <li>Create a chart</li>
                        <li>Plan a trip</li>
                        <li>Help me pick</li>
                        <li>Write a Python script</li>
                    </ul>
                </div>

                <div class="chat-container">
                    <form action="{{ url_for('send_message') }}" method="POST">
                        <label for="chat-input" class="chat-wrapper">
                            <textarea id="chat-input" name="message" placeholder="Ask anything"></textarea>
                        </label>

                        <input type="hidden" name="thread_id" value="{{ thread_id }}" />
                        <div class="button-bar">
                            <button id="send-message" type="submit">Send</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        const sendButton = document.getElementById('send-message');
        const chatInput = document.getElementById('chat-input');
        const chatWindow = document.getElementById('chat-window');
        const conversationHistory = document.getElementById('conversation-history');

        sendButton.addEventListener('click', function (event) {
            event.preventDefault();  // Prevent form submission

            const userMessage = chatInput.value;
            if (userMessage) {
                const userChat = document.createElement('li');
                userChat.classList.add('chat', 'outgoing-chat');
                userChat.innerHTML = `<span class="material-symbols-outlined">person</span><p>${userMessage}</p>`;
                chatWindow.appendChild(userChat);

                // Adding the message to the conversation history
                conversationHistory.innerHTML += `<li><strong>User:</strong> ${userMessage}</li>`;

                chatInput.value = '';  // Clear input after sending
            }
        });
    </script>
</body>
</html>
